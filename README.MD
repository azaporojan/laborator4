# Лабораторная работа №4

## Тема: Развёртывание сайта на базе Apache + PHP + MariaDB с использованием Docker и WordPress

## Цель работы
После выполнения этой лабораторной работы студент будет уметь:
 - Подготавливать Docker-образ для запуска веб-сайта на базе Apache HTTP Server + PHP (mod_php) + MariaDB;
 - Настраивать тома для хранения данных MariaDB и логов;
 - Настраивать конфигурационные файлы Apache, PHP и MariaDB;
 - Устанавливать WordPress в контейнере и проверять работу сайта.


## Используемые технологии

* Docker
* Debian base image
* Apache2
* PHP (libapache2-mod-php)
* MariaDB Server
* Supervisor
* WordPress.x

##  Основные этапы выполнения работы

### Копирование конфигураций с WSL

```bash
sudo cp /etc/apache2/sites-available/000-default.conf /mnt/c/Projects/laborator4/files/apache2/
sudo cp /etc/apache2/apache2.conf /mnt/c/Projects/laborator4/files/apache2/
sudo cp /etc/php/8.2/apache2/php.ini /mnt/c/Projects/laborator4/files/php/
sudo cp /etc/mysql/mariadb.conf.d/50-server.cnf /mnt/c/Projects/laborator4/files/mariadb/
```

### Редактирование конфигов (краткое изложение)

* Apache: добавлены `ServerName`, `DirectoryIndex`, изменён `DocumentRoot`, установлен email администратора.
* PHP: включён лог ошибок, увеличены лимиты памяти и загрузок.
* MariaDB: включён лог ошибок.

### Сборка образа

```bash
docker build -t apache2-php-mariadb .
```

### Запуск контейнера

```bash
docker run -d -p0:80 --name laborator4 apache2-php-mariadb
```

### Настройка WordPress

* Создана база данных `wordpress`
* Создан пользователь `wordpress`
* WordPress настроен через браузер
* Сгенерированный `wp-config.php` скопирован в проект и добавлен в Dockerfile

---

## Проверка работы

После сборки и запуска контейнера приложение доступно по адресу:

```
http://localhost:8000/
```

Открывается страница WordPress.

## Выводы

В ходе выполнения лабораторной работы был создан собственный Docker-образ, содержащий Apache, PHP, MariaDB, Supervisor и WordPress.
Были изучены принципы настройки веб-сервера, интерпретатора PHP и СУБД внутри контейнера, создано универсальное окружение, которое автоматически разворачивает CMS WordPress. Лабораторная закрепила навыки работы с Docker, конфигурированием сервисов и разворачиванием веб-приложений.


# Контрольные вопросы


## **1. Какие файлы конфигурации были изменены?**

Были изменены следующие конфигурационные файлы:

* `000-default.conf` — основной виртуальный хост Apache
* `apache2.conf` — глобальный конфигурационный файл Apache
* `php.ini` — конфигурация PHP
* `50-server.cnf` — конфигурация MariaDB
* `wp-config.php` — конфигурация WordPress

---

## **2. Для чего используется директива DirectoryIndex в Apache?**

`DirectoryIndex` указывает, **какой файл нужно открыть по умолчанию**, если пользователь заходит в папку без указания имени файла.

Например:

```apache
DirectoryIndex index.php index.html
```

Означает:
– сначала попытаться открыть `index.php`
– если нет — `index.html`.

---

## **3. Зачем нужен файл wp-config.php?**

`wp-config.php` содержит **основные настройки WordPress**, включая:

* параметры подключения к базе данных (имя БД, пользователь, пароль, хост),
* секретные ключи и соли безопасности,
* префикс таблиц,
* дополнительные настройки среды.

Без него WordPress не сможет работать.

---

## **4. Какой параметр в PHP отвечает за максимальный размер загружаемых файлов (post_max_size)?**

Параметр:

```ini
post_max_size
```

Он определяет **максимальный размер POST-запроса**, включая файлы из формы.
Чтобы разрешить загрузку больших файлов, его обычно увеличивают вместе с:

```ini
upload_max_filesize
```

---

## **5. Какие недостатки, по вашему мнению, имеет созданный Docker-образ?**

Короткий и объективный ответ:

* **Образ слишком “тяжёлый”**, так как включает Apache, PHP, MariaDB и WordPress в одном контейнере.
* Нарушена практика “**один контейнер — один сервис**” (best practice Docker).
* **База данных живёт внутри контейнера**, что приводит к потере данных при удалении контейнера.
* Образ **не оптимизирован слоями**, что увеличивает время сборки.
* WordPress скачивается при сборке, что может замедлять или ломаться при отсутствии доступа к интернету.
* Отсутствуют healthchecks и полноценная оркестрация.

---